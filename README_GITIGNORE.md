# Структура проекта STM32CubeIDE и правила .gitignore

Описание файлов и папок проекта: что хранится в git, что исключено, и почему.

## Файлы, которые ХРАНЯТСЯ в git

### Конфигурация проекта IDE

| Файл | Кто создаёт | Назначение |
| ------ | ----------- | ---------- |
| `.project` | STM32CubeIDE при создании проекта | XML-описание проекта Eclipse: имя, natures (тип проекта — MCU, C, managed build), команды сборки. Без него IDE не распознает папку как проект |
| `.cproject` | STM32CubeIDE при создании проекта | XML-конфигурация сборки: выбор MCU (STM32F411CEUx), FPU, float ABI, пути include (`../Core/Inc`, `../Drivers/...`), define-символы (`USE_HAL_DRIVER`, `STM32F411xE`), уровни оптимизации, linker script. Содержит настройки для Debug и Release конфигураций |
| `.mxproject` | CubeMX (встроен в CubeIDE) | Метаданные генератора кода: какие файлы были сгенерированы, пути к исходникам и заголовкам. Используется при регенерации кода |
| `primGPT_F411.ioc` | CubeMX | Главный файл конфигурации периферии: тактирование (HSE 25 MHz → PLL → 96 MHz), распиновка, настройки USART1/USART6/SPI1, FreeRTOS (задачи, heap), параметры GPIO. Из него CubeMX генерирует весь init-код |

### Настройки проекта (.settings/)

| Файл | Кто создаёт | Назначение |
| ------ | ----------- | ---------- |
| `.settings/org.eclipse.core.resources.prefs` | Eclipse | Кодировка проекта (UTF-8) |
| `.settings/stm32cubeide.project.prefs` | STM32CubeIDE | Хеши/версии внутренних настроек проекта |
| `.settings/com.st.stm32cube.ide.mcu.sfrview.prefs` | STM32CubeIDE | Настройки просмотра SFR (Special Function Registers) для отладки |

### Конфигурации отладки

| Файл | Кто создаёт | Назначение |
| ------ | ----------- | ---------- |
| `Run.launch` | STM32CubeIDE (Run → Debug Configurations) | Конфигурация отладки через ST-Link: протокол SWD, частота CPU 96 MHz, точка останова на `main`, стратегия сброса (connect under reset). Содержит серийный номер ST-Link — на другом ПК нужно обновить или убрать |
| `Run.cfg` | STM32CubeIDE | Скрипт OpenOCD: тип интерфейса (stlink-dap), транспорт (SWD), чип (STM32F411CEUx), частота отладки 8 kHz, настройки сброса. Используется при прошивке через `openocd -f Run.cfg` |
| `Debug_SEGGER.launch` | Вручную или IDE | Альтернативная конфигурация отладки через SEGGER J-Link |

### Linker scripts

| Файл | Кто создаёт | Назначение |
| ------ | ----------- | ---------- |
| `STM32F411CEUX_FLASH.ld` | CubeMX | Основной скрипт линковщика: размещение кода во Flash (512 KB с 0x08000000), RAM (128 KB с 0x20000000), размеры стека и heap |
| `STM32F411CEUX_RAM.ld` | CubeMX | Альтернативный скрипт для запуска из RAM (для отладки без прошивки Flash) |

### Исходный код

| Папка | Содержимое |
| ------- | ---------- |
| `Core/Src/` | Основные исходники: `main.c` (entry point), `uart.c`, `fram.c`, `crc16.c`, `freertos.c`, а также сгенерированные HAL-файлы (`stm32f4xx_it.c`, `stm32f4xx_hal_msp.c` и др.) |
| `Core/Inc/` | Заголовочные файлы: `DataFile.h` (протокол), `FreeRTOSConfig.h`, `main.h` и др. |
| `Core/Startup/` | `startup_stm32f411ceux.s` — ассемблерный startup: таблица векторов прерываний, инициализация `.bss`/`.data`, вызов `SystemInit()` → `main()` |
| `Drivers/` | HAL-драйверы ST (GPIO, UART, SPI, DMA, RCC, ...) и CMSIS-заголовки (core_cm4.h и др.). Сгенерированы CubeMX |
| `Middlewares/` | FreeRTOS v10.3.1: ядро (tasks.c, queue.c, ...), CMSIS-RTOS v2 обёртка, порт для ARM_CM4F, менеджер памяти heap_4.c |

---

## Файлы, которые ИСКЛЮЧЕНЫ из git (.gitignore)

### `Debug/`, `Release/`, `build/`

**Что это:** Папки, создаваемые STM32CubeIDE при сборке проекта.

**Кто создаёт:** IDE автоматически при первом Build (Project → Build Project).

**Что внутри:**

```text
Debug/
├── makefile            — автосгенерированный Makefile
├── objects.mk          — список объектных файлов
├── sources.mk          — список исходников
├── Core/
│   └── Src/
│       ├── main.o      — скомпилированные объектные файлы
│       ├── main.d      — файлы зависимостей
│       └── main.su     — Stack Usage анализ
├── Drivers/...         — скомпилированные драйверы
├── Middlewares/...     — скомпилированный FreeRTOS
├── primGPT_F411.elf   — финальная прошивка (ELF)
├── primGPT_F411.hex   — прошивка в Intel HEX
├── primGPT_F411.bin   — прошивка в бинарном виде
├── primGPT_F411.map   — карта памяти (адреса символов)
└── primGPT_F411.list  — дизассемблированный листинг
```

**Почему исключены:** Полностью генерируются из исходников. На каждой машине пересоздаются заново. Содержат бинарные файлы, которые раздувают размер репозитория.

**Как восстановить:** Project → Build Project в CubeIDE, или `make -C Debug all` из терминала.

### Артефакты сборки (`*.elf`, `*.hex`, `*.bin`, `*.map`, `*.list`)

**Что это:** Результаты компиляции и линковки, могут оказаться в корне при ручной сборке.

**Почему исключены:** Бинарные файлы, генерируются из исходников. Нет смысла хранить в git.

### Промежуточные файлы (`*.o`, `*.d`, `*.su`, `*.cyclo`)

| Расширение | Что это | Кто создаёт |
| ------------ | ------- | ----------- |
| `*.o` | Объектные файлы (скомпилированный машинный код) | `arm-none-eabi-gcc` при компиляции каждого `.c` файла |
| `*.d` | Файлы зависимостей (список header-ов, от которых зависит `.c`) | gcc с флагом `-MMD` |
| `*.su` | Stack Usage — сколько байт стека использует каждая функция | gcc с флагом `-fstack-usage` |
| `*.cyclo` | Cyclomatic complexity — метрика сложности функций | gcc с флагом `-fcyclomatic-complexity` |

### `.metadata/`

**Что это:** Служебная папка workspace (рабочего пространства) Eclipse/CubeIDE.

**Кто создаёт:** CubeIDE автоматически при запуске в выбранной папке workspace.

**Что внутри:**

```text
.metadata/
├── .log            — лог ошибок Eclipse
├── .ide.log        — лог CubeMX (загрузка плагинов, БД микроконтроллеров)
├── .lock           — файл блокировки (не даёт открыть workspace дважды)
├── .log4j2.xml     — конфигурация логирования
├── .plugins/       — кеши плагинов, индексы, состояние UI
└── version.ini     — версия формата workspace
```

**Почему исключена:** Содержит абсолютные пути текущей машины, кеши, логи сессий. На каждом ПК создаётся заново. Если закоммитить — будет конфликтовать при переносе между машинами.

**Важно:** Папка workspace и папка проекта — это разные вещи. При открытии CubeIDE нужно указать workspace = родительская папка (например `ProjectSTM/`), а затем импортировать проект из `F411CE/`.

### `.settings/language.settings.xml`

**Что это:** Кеш настроек сканера компилятора (scanner discovery).

**Кто создаёт:** Eclipse CDT автоматически при первой сборке. Запускает `arm-none-eabi-gcc` со специальными флагами, чтобы узнать встроенные define-ы и пути include.

**Почему исключён:** Содержит абсолютные пути к тулчейну, например:

```text
/opt/st/stm32cubeide_1.18.0/plugins/.../tools/bin/arm-none-eabi-gcc
```

На каждом ПК эти пути разные. Файл пересоздаётся автоматически.

### `.DS_Store`

**Что это:** Скрытый файл macOS, хранящий настройки отображения папки в Finder (размер иконок, сортировка, позиции файлов).

**Кто создаёт:** macOS Finder автоматически при просмотре папки.

**Почему исключён:** Не имеет отношения к проекту. Специфичен для macOS.

---

## Как правильно переносить проект между ПК

1. Клонировать репозиторий: `git clone <url>`
2. Открыть STM32CubeIDE, указать workspace = **родительская папка** (не сама папка проекта)
3. File → Import → General → Existing Projects into Workspace
4. Указать папку проекта, **НЕ ставить** "Copy projects into workspace"
5. Project → Build Project — IDE создаст папку `Debug/` с Makefile и соберёт прошивку
6. Настроить debug-конфигурацию (Run → Debug Configurations) под свой ST-Link
